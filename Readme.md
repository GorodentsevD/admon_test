# Приложение  Buffer

Приложение представляет собой Node.js  сервер с 2 роутами. Приложение работает с 2 Docker контейнерами: Node.js app и Redis

>POST /give - принимает в body параметр message в виде строки. Сохраняет строку в буффер на время MSG_TTL_MS

>GET /receive - принимает в query необязательный параметр count - кол-во строк, которые отправятся в ответ. Если параметр не указан, вернутся все строки из буфера


Реализовано 2 имплементации буфера: Нативный и при помощи Redis. Переключить имплементации можно через переменную окружения BUFFER_IMPL.

### Native Buffer
Нативный буфер представляет с собой JS объект, в который складируются сообщения. Ключ - время протухания сообщения в миллисекундах. Значение - сообщение. 
Буфер имеет методы `getMessages(count)`, который возвращает сообщения из буфера, удаляет их из буфера, также осуществляется удаление протухщих сообщений.
`storeMessage(message)` сохраняет сообщение в буфер


### Redis Buffer
В этой имплементации используем Redis sorted set для хранения сообщений. Score - ttl сообщения, value - само сообщение.
Данная имплементация также имеет методы `getMessages(count)` и `storeMessage(message)`.

### Переменные окружения:

Переменные окружения настраиваются в файле .env

|Parameter|Default|Description|
| --- | :---: | --- |
|APP_PORT|3000| Порт приложения|
|MSG_TTL_MS|30000|TTL сообщения в миллисекундах|
|REDIS_HOST|redis|Хост Redis'а|
|REDIS_PORT|6379|Порт Redis'а|
|BUFFER_IMPL|redis|Имплементация буфера ('redis' или 'native')|

### Запуск приложения
1. `npm install`
2. `./start.sh`


### Примеры запросов

>Сохранение сообщения в буфер: `curl -X POST -d message=hello http://0.0.0.0:3000/give`

>Получение первых 2 сообщений: `curl -X GET  http://0.0.0.0:3000/receive?count=2`

>Получение всех сообщений: `curl -X GET  http://0.0.0.0:3000/receive`